<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Kassadin Mid - Void Tracker</title>
    <link href="https://fonts.googleapis.com/css2?family=Anton&family=Roboto:wght@400;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <style>
        :root {
            --bg: #05000a;
            --card: rgba(20, 10, 30, 0.9);
            --primary: #c77dff; /* Violet Void */
            --accent: #e0aaff;
            --red: #ff3355;
            --yellow: #ffcc00;
            --green: #0aff6c; /* Gardé pour Easy/Win */
            --text: #eee;
        }

        * { box-sizing: border-box; margin: 0; padding: 0; }

        body {
            font-family: 'Roboto', sans-serif;
            color: var(--text);
            min-height: 100vh;
            background-image: url('https://ddragon.leagueoflegends.com/cdn/img/champion/splash/Kassadin_0.jpg');
            background-size: cover;
            background-position: center;
            background-attachment: fixed;
            transition: background-image 0.5s ease-in-out;
        }

        /* Overlay violet sombre */
        .bg-overlay {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: radial-gradient(circle at center, rgba(30, 0, 50, 0.6) 0%, rgba(5, 0, 10, 0.95) 100%);
            z-index: -1; pointer-events: none;
        }

        header { text-align: center; padding: 40px 20px; position: relative; }

        .skin-selector {
            position: absolute; top: 20px; right: 20px;
            background: rgba(0,0,0,0.8); border: 1px solid var(--primary); color: var(--primary);
            padding: 5px 10px; border-radius: 5px; cursor: pointer; font-family: 'Roboto';
        }

        h1 { 
            font-family: 'Anton', sans-serif; font-size: 4rem; margin-bottom: 30px; 
            text-shadow: 0 0 20px rgba(199, 125, 255, 0.5);
            letter-spacing: 2px;
        }
        .void-text { color: var(--primary); }

        .search-box { position: relative; max-width: 500px; margin: 0 auto 30px auto; }
        .search-box input {
            width: 100%; padding: 15px 50px 15px 25px; border-radius: 50px;
            border: 2px solid #333; outline: none; background: #0a0510; color: white; font-size: 1.2rem;
        }
        .search-box input:focus { border-color: var(--primary); box-shadow: 0 0 15px var(--primary); }
        .search-box i { position: absolute; right: 25px; top: 50%; transform: translateY(-50%); color: var(--primary); }

        .sorting-controls { display: flex; justify-content: center; gap: 15px; flex-wrap: wrap; margin-bottom: 20px; }
        .sort-btn {
            background: rgba(0,0,0,0.6); border: 2px solid #444; color: #888;
            padding: 10px 25px; font-family: 'Anton', sans-serif; font-size: 1.1rem;
            cursor: pointer; transition: 0.3s; border-radius: 4px; text-transform: uppercase;
            display: flex; align-items: center; gap: 10px;
        }
        .sort-btn:hover { transform: translateY(-3px); color: white; border-color: white; }
        .sort-btn.active { background: #1a0b2e; color: var(--primary); border-color: var(--primary); box-shadow: 0 0 15px var(--primary); }
        .sort-icon { font-size: 0.9rem; }

        /* Grid */
        #grid {
            display: grid; grid-template-columns: repeat(auto-fill, minmax(220px, 1fr));
            gap: 30px; padding: 20px 50px; max-width: 1400px; margin: 0 auto;
        }

        .card {
            background: var(--card); border: 1px solid #443355; border-radius: 8px;
            overflow: hidden; cursor: pointer; transition: 0.3s; position: relative;
        }
        .card:hover { transform: translateY(-10px); border-color: var(--primary); box-shadow: 0 0 25px rgba(199, 125, 255, 0.3); }
        .card img { width: 100%; height: 140px; object-fit: cover; object-position: top; border-bottom: 2px solid var(--primary); }
        .card h3 { padding: 15px; text-align: center; font-family: 'Anton'; font-size: 1.5rem; letter-spacing: 1px; margin: 0; }
        
        .card-wr-badge {
            position: absolute; bottom: 10px; right: 10px; font-size: 0.9rem; font-weight: bold;
            color: var(--accent); background: rgba(0,0,0,0.9); padding: 4px 8px; border-radius: 4px; border: 1px solid var(--primary);
        }

        .difficulty {
            position: absolute; top: 10px; right: 10px; padding: 5px 10px; font-size: 0.8rem; font-weight: bold;
            border-radius: 4px; text-transform: uppercase; color: black;
        }
        .easy { background: var(--green); }
        .medium { background: var(--yellow); }
        .hard { background: var(--red); color: white; }

        /* Modal */
        .modal { display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.95); z-index: 100; backdrop-filter: blur(5px); }
        .modal-content {
            background: #120a1a; width: 90%; max-width: 800px; margin: 5% auto;
            border: 1px solid var(--primary); border-radius: 8px; animation: popIn 0.3s;
            box-shadow: 0 0 50px rgba(199, 125, 255, 0.2);
        }
        @keyframes popIn { from { transform: scale(0.9); opacity: 0; } to { transform: scale(1); opacity: 1; } }

        #modal-header {
            height: 200px; background-size: cover; background-position: center; position: relative;
            padding: 20px; border-bottom: 2px solid var(--primary); display: flex; flex-direction: column; justify-content: flex-end;
        }
        #modal-header::after { content:''; position: absolute; top:0; left:0; width:100%; height:100%; background: linear-gradient(to top, #120a1a, transparent); }

        .modal-info-row { position: relative; z-index: 2; display: flex; justify-content: space-between; align-items: flex-end; width: 100%; }
        #modal-title { font-family: 'Anton'; font-size: 3.5rem; text-shadow: 3px 3px 0 #000; color: white; margin: 0; line-height: 1; }

        .meta-container { display: flex; flex-direction: column; align-items: flex-end; gap: 5px; }
        
        /* SPELL TRACKER */
        #summoner-spells { display: flex; gap: 10px; }
        .spell-wrapper { 
            position: relative; width: 50px; height: 50px; 
            cursor: pointer; transition: 0.2s; border-radius: 5px;
            overflow: hidden; border: 2px solid var(--primary);
        }
        .spell-wrapper.active-cd { border-color: var(--red); box-shadow: 0 0 15px var(--red); }
        .spell-icon { width: 100%; height: 100%; display: block; }
        .spell-timer-overlay {
            position: absolute; top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(0, 0, 0, 0.85); color: white;
            display: none; align-items: center; justify-content: center;
            font-weight: bold; font-size: 1.4rem; z-index: 10;
        }
        .spell-wrapper.active-cd .spell-timer-overlay { display: flex; }

        .ult-timer { font-size: 0.9rem; color: #aaa; background: rgba(0,0,0,0.7); padding: 5px 10px; border-radius: 4px; border: 1px solid #444; }
        .ult-timer span { color: var(--primary); font-weight: bold; }

        .youtube-btn {
            display: inline-block; background: #cc0000; color: white; padding: 5px 15px;
            font-size: 0.9rem; font-weight: bold; text-decoration: none; border-radius: 4px;
            margin-top: 5px; border: 1px solid #ff4444; transition: 0.2s;
        }
        .youtube-btn:hover { background: red; transform: scale(1.05); }

        .close-btn { position: absolute; top: 20px; right: 30px; font-size: 40px; cursor: pointer; color: white; z-index: 10; transition: 0.2s; }
        .close-btn:hover { color: var(--primary); }

        .scoreboard-bar {
            background: #1a0b2e; border-bottom: 1px solid #443355; padding: 15px 30px;
            display: flex; align-items: center; justify-content: space-between;
        }
        .stats-display { font-family: 'Anton'; font-size: 1.8rem; color: #fff; }
        .stats-display span { font-size: 1rem; color: #bbb; font-family: 'Roboto'; margin-left: 10px; }
        
        .stats-controls { display: flex; gap: 10px; align-items: center; }
        .stat-btn {
            border: none; padding: 10px 30px; font-weight: bold; cursor: pointer; border-radius: 4px; color: white;
            font-family: 'Anton'; letter-spacing: 1px; font-size: 1rem; transition: 0.2s;
        }
        .btn-win { background: #00b894; border: 2px solid #00b894; }
        .btn-win:hover { background: #00a382; transform: scale(1.05); }
        .btn-lose { background: #d63031; border: 2px solid #d63031; }
        .btn-lose:hover { background: #c0392b; transform: scale(1.05); }
        .btn-reset { background: #2d3436; border: 1px solid #636e72; color: #b2bec3; padding: 10px 15px; }
        .btn-reset:hover { background: #636e72; color: white; }

        .modal-body { padding: 30px; display: flex; flex-direction: column; gap: 20px; }
        .main-content { display: flex; gap: 30px; }
        .strategy-section { flex: 1; }
        .notes-section { flex: 1; display: flex; flex-direction: column; }

        .box { padding: 15px; background: #1f122e; border-radius: 5px; margin-bottom: 20px; border-left: 4px solid #555; }
        .box.pros { border-color: var(--green); }
        .box.cons { border-color: var(--red); }
        .box h3 { font-size: 1.1rem; color: #fff; margin-bottom: 10px; font-family: 'Anton'; }

        textarea { width: 100%; height: 200px; background: #0d0614; border: 1px solid #443355; color: var(--accent); padding: 15px; resize: none; margin-bottom: 15px; font-family: monospace; font-size: 1rem; }
        textarea:focus { border-color: var(--primary); outline: none; }
        #save-btn { width: 100%; padding: 15px; background: var(--primary); color: black; border: none; font-weight: bold; cursor: pointer; font-family: 'Anton'; font-size: 1.2rem; transition: 0.3s; }
        #save-btn:hover { background: white; }
        #save-msg { display: block; text-align: center; color: var(--primary); margin-top: 10px; opacity: 0; transition: 0.3s; }

        @media (max-width: 800px) {
            .main-content { flex-direction: column; }
            .scoreboard-bar { flex-direction: column; gap: 15px; text-align: center; }
            h1 { font-size: 3rem; }
            .skin-selector { top: 10px; right: 10px; font-size: 0.8rem; }
        }
    </style>
</head>
<body>

    <div class="bg-overlay"></div>

    <header>
        <select id="skin-select" class="skin-selector" onchange="changeSkin(this.value)">
            <option value="0">Classique</option>
            <option value="2">Kassadin des Profondeurs</option>
            <option value="4">Faucheur Cosmique</option>
            <option value="5">Hextech</option>
            <option value="6">Comte Kassadin</option>
            <option value="14">Shockblade</option>
        </select>

        <h1>KASSADIN <span class="void-text">MID</span></h1>
        
        <div class="search-box">
            <i class="fas fa-search"></i>
            <input type="text" id="searchInput" placeholder="Chercher une victime...">
        </div>

        <div class="sorting-controls">
            <button class="sort-btn active" id="sort-name" onclick="sortData('name')">
                <i class="fas fa-font sort-icon"></i> A-Z
            </button>
            <button class="sort-btn" id="sort-wr" onclick="sortData('wr')">
                <i class="fas fa-trophy sort-icon"></i> WINRATE %
            </button>
        </div>
    </header>

    <main id="grid">
        </main>

    <div id="modal" class="modal">
        <div class="modal-content">
            <span class="close-btn">&times;</span>
            <div id="modal-header">
                <div class="modal-info-row">
                    <h2 id="modal-title">CHAMPION</h2>
                    <div class="meta-container">
                        <div id="summoner-spells"></div>
                        <div id="ult-timer-display" class="ult-timer"></div>
                        <div id="youtube-container"></div>
                    </div>
                </div>
            </div>
            
            <div class="scoreboard-bar">
                <div class="stats-display" id="stats-display">
                    0% WR <span>(0V - 0D)</span>
                </div>
                <div class="stats-controls">
                    <button class="stat-btn btn-win" onclick="addWin()"><i class="fas fa-check"></i> VICTOIRE</button>
                    <button class="stat-btn btn-lose" onclick="addLoss()"><i class="fas fa-times"></i> DÉFAITE</button>
                    <button class="stat-btn btn-reset" onclick="resetStats()" title="Reset"><i class="fas fa-trash"></i></button>
                </div>
            </div>

            <div class="modal-body">
                <div class="main-content">
                    <div class="strategy-section">
                        <div class="box pros">
                            <h3><i class="fas fa-check"></i> POINTS FORTS</h3>
                            <p id="modal-pros"></p>
                        </div>
                        <div class="box cons">
                            <h3><i class="fas fa-times"></i> POINTS FAIBLES</h3>
                            <p id="modal-cons"></p>
                        </div>
                    </div>

                    <div class="notes-section">
                        <h3><i class="fas fa-pencil-alt"></i> MES NOTES</h3>
                        <textarea id="user-notes" placeholder="Plan de jeu, item rush, astuces..."></textarea>
                        <button id="save-btn">SAUVEGARDER NOTES</button>
                        <span id="save-msg">Sauvegardé !</span>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        const spellUrl = (spell) => `https://ddragon.leagueoflegends.com/cdn/13.24.1/img/spell/Summoner${spell}.png`;

        const spellCDs = { "Flash": 300, "Ghost": 240, "Barrier": 180, "Ignite": 180, "Teleport": 360, "Exhaust": 210, "Heal": 240, "Cleanse": 210 };
        let activeTimers = {};

        const data = [
            // HARD MATCHUPS (AD / Heavy Burst)
            { id: "Talon", name: "Talon", diff: "hard", img: "Talon", spells: ["Flash", "Ignite"], ult: "100s / 80s / 60s", 
              pros: "Signale ses décalages. Tu scales mieux.", cons: "Il te oneshot niveau 2-3 avec Ignite. Rush Seeker's Armguard." },
            { id: "Zed", name: "Zed", diff: "hard", img: "Zed", spells: ["Flash", "Ignite"], ult: "120s / 100s / 80s", 
              pros: "Rush Zhonya en premier item. Prends la rune Électrocution pour trade back.", cons: "Si tu utilises ton R agressivement, il te tue avec son R." },
            { id: "Lucian", name: "Lucian", diff: "hard", img: "Lucian", spells: ["Flash", "Ignite"], ult: "110s / 100s / 90s", 
              pros: "Survis jusqu'au niveau 6. Farm sous tour.", cons: "Il te zone complètement niveau 1-5. Ne prends pas de dégâts pour 1 sbire." },
            { id: "Tristana", name: "Tristana", diff: "hard", img: "Tristana", spells: ["Flash", "Ignite"], ult: "120s / 110s / 100s", 
              pros: "Demande des ganks, elle push automatiquement.", cons: "Dégâts physiques énormes. Sa bombe (E) sur ta tour te force à reculer." },
            { id: "Pantheon", name: "Pantheon", diff: "hard", img: "Pantheon", spells: ["Flash", "Ignite"], ult: "180s / 165s / 150s", 
              pros: "Il tombe en late game. Farm et ne meurs pas.", cons: "Son stun (W) est inesquivable. Il bloque tes dégâts avec son E." },
            { id: "Irelia", name: "Irelia", diff: "hard", img: "Irelia", spells: ["Flash", "Ignite"], ult: "140s / 120s / 100s", 
              pros: "Rien avant le niveau 11.", cons: "Elle te tue en 1v1 même si tu as 2 kills d'avance. Ne t'approche pas des sbires low HP." },
            { id: "Yone", name: "Yone", diff: "hard", img: "Yone", spells: ["Flash", "Ignite"], ult: "120s / 100s / 80s", 
              pros: "Esquive son R avec ton R. Frozen Heart est viable.", cons: "Dégâts mixtes, bouclier, dashs infinis. Très dur." },
            { id: "Jayce", name: "Jayce", diff: "hard", img: "Jayce", spells: ["Flash", "Teleport"], ult: "N/A", 
              pros: "S'il change en marteau, recule. Farm.", cons: "Poke énorme. All-in très fort." },
            { id: "Akshan", name: "Akshan", diff: "hard", img: "Akshan", spells: ["Flash", "Ignite"], ult: "100s / 85s / 70s", 
              pros: "Interromps son grappin avec ton R si possible (dur).", cons: "Double auto-attaque et bouclier passif te détruisent early." },

            // MEDIUM MATCHUPS (Skill / Mages Burst)
            { id: "Sylas", name: "Sylas", diff: "medium", img: "Sylas", spells: ["Flash", "Ignite"], ult: "100s / 80s / 60s", 
              pros: "Prends anti-heal. Ton Q annule ses dégâts magiques.", cons: "Il te vole ton R et l'utilise mieux que toi early." },
            { id: "Yasuo", name: "Yasuo", diff: "medium", img: "Yasuo", spells: ["Flash", "Ignite"], ult: "80s / 55s / 30s", 
              pros: "Max E (Force Pulse) car il stack tes sorts. AA + W brise son passif.", cons: "Son mur bloque ton Q. Fort en early." },
            { id: "Leblanc", name: "LeBlanc", diff: "medium", img: "Leblanc", spells: ["Flash", "Ignite"], ult: "60s / 45s / 30s", 
              pros: "Ton passif réduit ses dégâts. Tu outscale.", cons: "Elle setup très bien les ganks. Attention aux chaînes." },
            { id: "Ahri", name: "Ahri", diff: "medium", img: "Ahri", spells: ["Flash", "Teleport"], ult: "130s / 105s / 80s", 
              pros: "Ton Q shield absorbe son poke. Tu peux la chase.", cons: "Si elle touche son charme (E) sous tour, tu meurs." },
            { id: "Katarina", name: "Katarina", diff: "medium", img: "Katarina", spells: ["Flash", "Ignite"], ult: "90s / 60s / 45s", 
              pros: "Ton Q (Silence) annule son ultime. Garde-le pour ça.", cons: "Si elle roam et prend des kills bot, tu perds la game." },
            { id: "Fizz", name: "Fizz", diff: "medium", img: "Fizz", spells: ["Flash", "Ignite"], ult: "100s / 85s / 70s", 
              pros: "Ton bouclier Q bloque son dot. Poke le.", cons: "Son R + E burst est énorme. Zhonya obligatoire." },
            { id: "Vex", name: "Vex", diff: "medium", img: "Vex", spells: ["Flash", "Teleport"], ult: "140s / 120s / 100s", 
              pros: "Ton passif aide contre ses dégâts magiques.", cons: "Son passif 'Fear' counter ta mobilité (R). Ne R pas sur elle si elle a sa barre rouge." },
            { id: "Akali", name: "Akali", diff: "medium", img: "Akali", spells: ["Flash", "Ignite"], ult: "100s / 80s / 60s", 
              pros: "Révèle-la si possible. Spam E dans son linceul.", cons: "Dégâts absurdes. Ne reste pas au corps à corps." },
            { id: "Zoe", name: "Zoe", diff: "medium", img: "Zoe", spells: ["Flash", "Ignite"], ult: "11s", 
              pros: "Cleanse ou Mercures obligatoires. Tu la oneshot en late.", cons: "Si tu dors, tu meurs." },
            { id: "Qiyana", name: "Qiyana", diff: "medium", img: "Qiyana", spells: ["Flash", "Ignite"], ult: "120s", 
              pros: "Elle est fragile si tu survis au burst. Seeker's Armguard.", cons: "AD Assassin. Son R te stun contre les murs." },

            // EASY MATCHUPS (Free Scaling / Mages immobiles)
            { id: "Veigar", name: "Veigar", diff: "easy", img: "Veigar", spells: ["Flash", "Teleport"], ult: "120s / 100s / 80s", 
              pros: "Ton R te permet de passer PAR DESSUS sa cage. Free kill.", cons: "Son R fait mal en late, mais tu devrais avoir gagné avant." },
            { id: "AurelionSol", name: "Aurelion Sol", diff: "easy", img: "AurelionSol", spells: ["Flash", "Teleport"], ult: "120s / 110s / 100s", 
              pros: "Ton Q interrompt son vol (W) et son souffle (Q).", cons: "Il scale bien aussi, ne le laisse pas free farm." },
            { id: "Karthus", name: "Karthus", diff: "easy", img: "Karthus", spells: ["Flash", "Exhaust"], ult: "200s / 180s / 160s", 
              pros: "Tu annules son R avec ton Q. Il ne peut pas te fuir.", cons: "Son Q fait mal si tu es isolé." },
            { id: "TwistedFate", name: "Twisted Fate", diff: "easy", img: "TwistedFate", spells: ["Flash", "Teleport"], ult: "180s / 150s / 120s", 
              pros: "Il ne peut rien faire en 1v1. Spam kill.", cons: "Son R lui permet d'aider les autres lanes. Ping le SS." },
            { id: "Lux", name: "Lux", diff: "easy", img: "Lux", spells: ["Flash", "Barrier"], ult: "60s / 50s / 40s", 
              pros: "Esquive la cage avec R, elle est morte.", cons: "Poke longue distance pénible early." },
            { id: "Xerath", name: "Xerath", diff: "easy", img: "Xerath", spells: ["Flash", "Barrier"], ult: "130s / 115s / 100s", 
              pros: "R sur lui = Kill. Il est immobile.", cons: "Reste mobile pour esquiver le poke." },
            { id: "Vladimir", name: "Vladimir", diff: "easy", img: "Vladimir", spells: ["Flash", "Ghost"], ult: "150s / 135s / 120s", 
              pros: "Il ne peut pas te tuer. Tu as le meilleur scaling.", cons: "Prends anti-heal." },
            { id: "Anivia", name: "Anivia", diff: "easy", img: "Anivia", spells: ["Flash", "Teleport"], ult: "6s", 
              pros: "Ton Q annule son R. R pour esquiver le stun.", cons: "Son passif (Oeuf) est chiant. Demande de l'aide." },
            { id: "Malzahar", name: "Malzahar", diff: "easy", img: "Malzahar", spells: ["Flash", "Teleport"], ult: "140s / 110s / 80s", 
              pros: "Ton Q brise son passif. Ton E nettoie ses voidlings.", cons: "Son R t'oblige à payer une QSS (Ceinture de Mercure)." },
            { id: "Ryze", name: "Ryze", diff: "easy", img: "Ryze", spells: ["Flash", "Teleport"], ult: "210s / 180s / 150s", 
              pros: "Tu tank ses dégâts. Il ne peut pas s'enfuir.", cons: "Il waveclear très vite." },
            { id: "Corki", name: "Corki", diff: "easy", img: "Corki", spells: ["Flash", "Teleport"], ult: "12s", 
              pros: "Tu tank son poke. R sur lui quand il utilise son W.", cons: "Dégâts mixtes." },
            { id: "Annie", name: "Annie", diff: "easy", img: "Annie", spells: ["Flash", "Ignite"], ult: "120s / 100s / 80s", 
              pros: "Ton Q shield absorbe son burst. Prends Mercures.", cons: "Son stun est point & click." },
            { id: "Brand", name: "Brand", diff: "easy", img: "Brand", spells: ["Flash", "Ignite"], ult: "105s / 90s / 75s", 
              pros: "Il est immobile. R pour esquiver le stun.", cons: "Dégâts sur la durée élevés." }
        ];

        const grid = document.getElementById('grid');
        const search = document.getElementById('searchInput');
        const modal = document.getElementById('modal');
        const mTitle = document.getElementById('modal-title');
        const mHeader = document.getElementById('modal-header');
        const mPros = document.getElementById('modal-pros');
        const mCons = document.getElementById('modal-cons');
        const mNotes = document.getElementById('user-notes');
        const mSpells = document.getElementById('summoner-spells');
        const mUlt = document.getElementById('ult-timer-display');
        const mYoutube = document.getElementById('youtube-container');
        const saveBtn = document.getElementById('save-btn');
        const saveMsg = document.getElementById('save-msg');
        const closeBtn = document.querySelector('.close-btn');
        const statsDisplay = document.getElementById('stats-display');
        const sortNameBtn = document.getElementById('sort-name');
        const sortWrBtn = document.getElementById('sort-wr');

        let sortBy = 'name';
        let sortDirection = 'asc';
        let currentId = null;

        function changeSkin(skinId) {
            document.body.style.backgroundImage = `url('https://ddragon.leagueoflegends.com/cdn/img/champion/splash/Kassadin_${skinId}.jpg')`;
        }

        function sortData(criteria) {
            if (sortBy === criteria) {
                sortDirection = sortDirection === 'asc' ? 'desc' : 'asc';
            } else {
                sortBy = criteria;
                sortDirection = criteria === 'wr' ? 'desc' : 'asc';
            }
            sortNameBtn.classList.toggle('active', criteria === 'name');
            sortWrBtn.classList.toggle('active', criteria === 'wr');
            render(search.value);
        }

        function render(filterText = "") {
            if(!grid) return;
            grid.innerHTML = "";
            let filtered = data.filter(c => c.name.toLowerCase().includes(filterText.toLowerCase()));

            filtered = filtered.map(c => {
                const s = getStats(c.id);
                const total = s.wins + s.losses;
                const wrValue = total > 0 ? (s.wins / total) * 100 : -1; 
                return { ...c, wrValue };
            });

            filtered.sort((a, b) => {
                if (sortBy === 'name') {
                    return sortDirection === 'asc' ? a.name.localeCompare(b.name) : b.name.localeCompare(a.name);
                } else if (sortBy === 'wr') {
                    return sortDirection === 'asc' ? a.wrValue - b.wrValue : b.wrValue - a.wrValue;
                }
            });

            if (filtered.length === 0) {
                grid.innerHTML = "<p style='text-align:center; width:100%; color:#555;'>Aucun champion trouvé.</p>";
                return;
            }

            filtered.forEach(c => {
                const div = document.createElement('div');
                div.className = 'card';
                const wrDisplay = c.wrValue >= 0 ? Math.round(c.wrValue) + "%" : "-";
                
                div.innerHTML = `
                    <div class="card-wr-badge">${wrDisplay} WR</div>
                    <img src="https://ddragon.leagueoflegends.com/cdn/img/champion/splash/${c.img}_0.jpg" loading="lazy">
                    <span class="difficulty ${c.diff}">${c.diff.toUpperCase()}</span>
                    <h3>${c.name}</h3>
                `;
                div.onclick = () => openModal(c);
                grid.appendChild(div);
            });
        }

        function openModal(c) {
            currentId = c.id;
            mTitle.innerText = c.name.toUpperCase();
            mHeader.style.backgroundImage = `url('https://ddragon.leagueoflegends.com/cdn/img/champion/splash/${c.img}_0.jpg')`;
            mPros.innerText = c.pros;
            mCons.innerText = c.cons;
            
            mSpells.innerHTML = c.spells.map(spell => {
                return `
                <div class="spell-wrapper" id="spell-btn-${spell}" onclick="toggleSpellTimer('${c.id}', '${spell}')" title="Cliquer pour lancer le timer">
                    <img src="${spellUrl(spell)}" class="spell-icon">
                    <div class="spell-timer-overlay" id="timer-overlay-${spell}"></div>
                </div>`;
            }).join('');
            
            c.spells.forEach(spell => updateSpellUI(c.id, spell));

            mUlt.innerHTML = `R CD: <span>${c.ult || 'N/A'}</span>`;
            mYoutube.innerHTML = `<a href="https://www.youtube.com/results?search_query=Kassadin+vs+${c.name}+Mid+Challenger+DomisumReplay" target="_blank" class="youtube-btn"><i class="fab fa-youtube"></i> VOIR REPLAY</a>`;

            mNotes.value = localStorage.getItem(`kass_note_${c.id}`) || "";
            updateStatsUI(c.id);
            modal.style.display = "block";
            saveMsg.style.opacity = "0";
        }

        // --- TRACKER FUNCTIONS ---
        function toggleSpellTimer(champId, spell) {
            const timerKey = `${champId}_${spell}`;
            const cd = spellCDs[spell] || 300; 

            if (activeTimers[timerKey] && activeTimers[timerKey].endTime > Date.now()) {
                delete activeTimers[timerKey]; 
                updateSpellUI(champId, spell);
            } else {
                activeTimers[timerKey] = { endTime: Date.now() + (cd * 1000) }; 
                updateSpellUI(champId, spell);
            }
        }

        function updateSpellUI(champId, spell) {
            const wrapper = document.getElementById(`spell-btn-${spell}`);
            const overlay = document.getElementById(`timer-overlay-${spell}`);
            const timerKey = `${champId}_${spell}`;
            const timerData = activeTimers[timerKey];

            if(window[`interval_${timerKey}`]) clearInterval(window[`interval_${timerKey}`]);

            if (timerData && timerData.endTime > Date.now()) {
                if(wrapper) wrapper.classList.add('active-cd');
                const tick = () => {
                    const remaining = Math.ceil((timerData.endTime - Date.now()) / 1000);
                    if(remaining <= 0) {
                        delete activeTimers[timerKey];
                        if(wrapper) wrapper.classList.remove('active-cd');
                        clearInterval(window[`interval_${timerKey}`]);
                    } else {
                        if(overlay) overlay.innerText = remaining;
                    }
                };
                tick();
                window[`interval_${timerKey}`] = setInterval(tick, 1000);
            } else {
                if(wrapper) wrapper.classList.remove('active-cd');
            }
        }

        // --- STATS (Clé unique 'kass_' pour ne pas mélanger avec Warwick) ---
        function getStats(id) {
            const s = localStorage.getItem(`kass_stats_${id}`);
            return s ? JSON.parse(s) : { wins: 0, losses: 0 };
        }

        function saveStats(id, stats) {
            localStorage.setItem(`kass_stats_${id}`, JSON.stringify(stats));
            updateStatsUI(id);
            render(search.value);
        }

        function updateStatsUI(id) {
            const s = getStats(id);
            const total = s.wins + s.losses;
            const wr = total > 0 ? Math.round((s.wins / total) * 100) : 0;
            let color = "#fff";
            if(total > 0) {
                if(wr >= 55) color = "#0aff6c"; // Green
                else if(wr < 45) color = "#ff3355"; // Red
                else color = "#ffcc00"; // Yellow
            }
            statsDisplay.innerHTML = `<span style="color:${color}; font-size:1.8rem; margin:0;">${wr}% WR</span> <span>(${s.wins}V - ${s.losses}D)</span>`;
        }

        window.addWin = () => { if(!currentId) return; const s = getStats(currentId); s.wins++; saveStats(currentId, s); }
        window.addLoss = () => { if(!currentId) return; const s = getStats(currentId); s.losses++; saveStats(currentId, s); }
        window.resetStats = () => { 
            if(!currentId) return; 
            if(confirm("Reset stats pour ce champion ?")) {
                saveStats(currentId, { wins: 0, losses: 0 });
            }
        }

        saveBtn.onclick = () => {
            if(currentId) {
                localStorage.setItem(`kass_note_${currentId}`, mNotes.value);
                saveMsg.style.opacity = "1";
                setTimeout(() => { saveMsg.style.opacity = "0"; }, 2000);
            }
        };

        search.oninput = (e) => render(e.target.value);
        closeBtn.onclick = () => modal.style.display = "none";
        window.onclick = (e) => { if(e.target == modal) modal.style.display = "none"; };

        render();
    </script>
</body>
</html>
